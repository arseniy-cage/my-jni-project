name: Build JNI with Windows NDK r16b

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest  # Используем Windows runner

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        # Устанавливаем Python и gdown для скачивания с Google Drive
        python -m pip install --upgrade pip
        pip install gdown

    - name: Download NDK from Google Drive
      run: |
        gdown "https://drive.google.com/uc?id=1ThXZY2oy-K1ycO489_9P7OO4evG4lcIT" -O ndk.zip
        7z x ndk.zip -o"$env:USERPROFILE\android-ndk-r16b" -y
        echo "NDK_HOME=$env:USERPROFILE\android-ndk-r16b" >> $env:GITHUB_ENV
        echo "$env:USERPROFILE\android-ndk-r16b" >> $env:GITHUB_PATH

    - name: Verify NDK installation
      run: |
        echo "NDK path: $env:NDK_HOME"
        dir "$env:NDK_HOME"
        call "$env:NDK_HOME\ndk-build.cmd" --version

    - name: Build JNI
      run: |
        cd $env:GITHUB_WORKSPACE
        call "$env:NDK_HOME\ndk-build.cmd" -C . clean
        call "$env:NDK_HOME\ndk-build.cmd" -C .

    - name: Upload compiled artifacts
      uses: actions/upload-artifact@v4
      with:
        name: jni-compiled-libraries
        path: libs/
